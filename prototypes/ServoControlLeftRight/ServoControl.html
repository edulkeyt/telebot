<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"> 
<html lang="en"> 
	<head> 
		<meta http-equiv="content-type" content="text/html; charset=utf-8"> 
		<title>Servo control</title> 
	</head> 
	<body> 
		<input id="btnLeft" type="button" style="height:100px; width:100px;"/>
		<input id="txt" type="text"/>
		<input id="btnRight" type="button" style="height:100px; width:100px;"/>
				<script>
			
			function httpGetAsync(theUrl, callback) {
				var xmlHttp = new XMLHttpRequest();
				xmlHttp.onreadystatechange = function() { 
					if (callback != null && xmlHttp.readyState == 4 && xmlHttp.status == 200)
						callback(xmlHttp.responseText);
				}
				xmlHttp.open("GET", theUrl, true);
				xmlHttp.send(null);
			}
			
			function initButton(btnId, txtId, intervalMillis, url, urlCancel){
				
				var isPressed = false;
				var btn = document.getElementById(btnId);
				
				function updatePosition(position){
					if (position) document.getElementById(txtId).value = position;
				}
				
				function buttonDown(){
					
					isPressed = true;
					
					function intervalAction(){
						if(!isPressed) return;
						httpGetAsync(url, updatePosition);
						setTimeout(intervalAction, intervalMillis );
					}
					
					intervalAction();
				}
				
				
				function buttonUp(){
					
					isPressed = false;
					httpGetAsync(urlCancel, updatePosition);
				}
				
				btn.onpointerdown = buttonDown;
				btn.onpointerup = buttonUp;
			}
			
			function getUrlCommand(command){
				return window.location.origin + "/" + command;
			}
			
			var intervalMillis = 200;
			stopUrl = getUrlCommand("stop");
			
			initButton("btnLeft", "txt", intervalMillis, getUrlCommand("left"), stopUrl);
			initButton("btnRight", "txt", intervalMillis, getUrlCommand("right"), stopUrl);
			
			/*document.getElementById("btnParams").onclick = 
				function(){
					httpGetAsync(getUrlCommand("a" + document.getElementById("txtParams").value), null);
				}*/
			
		</script>
	</body> 
</html>